(function(e,X){typeof exports=="object"&&typeof module<"u"?module.exports=X(require("vue")):typeof define=="function"&&define.amd?define(["vue"],X):(e=typeof globalThis<"u"?globalThis:e||self,e.vueDragMenuPlus=X(e.Vue))})(this,function(e){"use strict";const X="",ve=["title","onMousedown","onTouchstart","onClick"],se=[{__name:"index",props:{list:{type:Array,default:()=>[{icon:"icon-insert icon-setting",title:"\u83DC\u5355",style:{background:"#fff",color:""}},{icon:"icon-insert icon-myCenter",style:{background:"rgb(255, 92, 92)"}},{icon:"icon-insert icon-notice",style:{background:"rgb(92, 209, 255)"}},{icon:"icon-insert icon-expression",style:{background:"rgb(255, 241, 92)"}},{icon:"icon-insert icon-collection",style:{background:"rgb(100, 245, 146)"}}]},closeOnClick:{type:Boolean,default:!0}},emits:["click"],setup(x,{emit:z}){const L=x;let d=e.ref([]),M=e.ref(null),p=e.ref(null),w=e.ref(null),h=e.ref(null),Y=e.ref(null),A=e.ref(6),u=e.ref(10),T=e.ref(null),E=e.ref(null),m=e.ref(null),I=e.ref(null),b=e.ref(null),N=e.ref(null),y=e.ref(null),k=e.ref(null),O=e.ref(!1),P=e.ref(null),F=e.ref(null),W=e.ref(null),_=e.ref(null),C=e.ref(null),q=e.ref(null),j=e.ref(null),D=e.ref(null),U=e.ref(null),J=e.ref(null),f=e.ref(!1),g=e.ref(!0),v=e.ref([]),c=e.ref(null),r=e.ref(null);const ie=(l,a)=>l.classList?l.classList.contains(a):new RegExp("\\s"+a+"\\s").test(" "+l.className+" "),fe=(l,a)=>{let i=[],t=n=>{n.forEach(s=>{ie(s,a)&&i.push(s),s.childNodes&&s.childNodes.length>0&&t(s.childNodes)})};return t(l.childNodes),i},o=(l,a,i)=>new Promise((t,n)=>{setTimeout(()=>{for(const s in a)l[s]=a[s];t()},i)}),K=()=>{d.value.forEach(async(l,a)=>{a>0&&(f.value?(await o(l,{top:r.value+u.value},40),await o(l,{top:r.value-u.value},80),await o(l,{top:r.value},50)):(await o(l,{top:r.value-(a*(h.value+u.value)+u.value)},40),await o(l,{top:r.value-a*(h.value+u.value)},100)))}),f.value=!f.value},Q=()=>{d.value.forEach(async(l,a)=>{a>0&&(f.value?(await o(l,{top:r.value-u.value},40),await o(l,{top:r.value+u.value},80),await o(l,{top:r.value},50)):(await o(l,{top:r.value+(a*(h.value+u.value)+u.value)},40),await o(l,{top:r.value+a*(h.value+u.value)},100)))}),f.value=!f.value},Z=()=>{d.value.forEach(async(l,a)=>{a>0&&(f.value?(await o(l,{left:c.value+u.value},40),await o(l,{left:c.value-u.value},80),await o(l,{left:c.value},50)):(await o(l,{left:c.value-(a*(w.value+u.value)+u.value)},40),await o(l,{left:c.value-a*(w.value+u.value)},100)))}),f.value=!f.value},ee=()=>{d.value.forEach(async(l,a)=>{a>0&&(f.value?(await o(l,{left:c.value-u.value},40),await o(l,{left:c.value+u.value},80),await o(l,{left:c.value},50)):(await o(l,{left:c.value+(a*(w.value+u.value)+u.value)},40),await o(l,{left:c.value+a*(w.value+u.value)},100)))}),f.value=!f.value},G=(l=0)=>{if(z("click",L.list[l],l),l===0||L.closeOnClick){let a,i,t,n;a=p.value.offsetLeft,i=p.value.offsetTop,a>0?i<0?(t=T.value/2-a-w.value,n=E.value/2+i,t+10<n?Z():Q()):(t=T.value/2-a-w.value,n=E.value/2-i-h.value,t+10<n?Z():K()):i<0?(t=T.value/2+a,n=E.value/2+i,t+10<n?ee():Q()):(t=T.value/2+a,n=E.value/2-i-h.value,t+10<n?ee():K())}},le=()=>{f.value&&G(0)},V=()=>{le(),T.value=window.innerWidth,E.value=window.innerHeight,b.value=T.value-w.value,N.value=E.value-h.value,m.value=M.value.offsetLeft,I.value=M.value.offsetTop,y.value=b.value-m.value-10,k.value=N.value-I.value-10,d.value.forEach(l=>{l.left=y.value,l.top=k.value})},ce=()=>{if(v.value.length>1){let l,a,i=v.value[v.value.length-2].x,t=v.value[v.value.length-2].y,n=v.value[v.value.length-1].x,s=v.value[v.value.length-1].y,S=Math.abs(n-i),oe=Math.abs(s-t);S===0?(l=0,a=u.value):(l=Math.sqrt(Math.pow(u.value,2)*Math.pow(S,2)/(Math.pow(S,2)+Math.pow(oe,2))),a=l*oe/S),d.value.forEach((R,ue)=>{ue>0&&setTimeout(async()=>{await o(R,{left:i,top:t},50),await o(R,{left:n>i?n+l:n-l,top:s>t?s+a:s-a},50),await o(R,{left:n>i?n-l:n+l,top:s>t?s-a:s+a},100),await o(R,{left:n,top:s},50)},ue*120)})}v=[]},ae=()=>{g.value?(W.value=event.offsetX,_.value=event.offsetY):(W.value=event.changedTouches[0].clientX-T.value/2-p.value.offsetLeft,_.value=event.changedTouches[0].clientY-E.value/2-p.value.offsetTop),P.value=p.value.offsetLeft,F.value=p.value.offsetTop,q.value=W.value,j.value=b.value+W.value,U.value=_.value,J.value=N.value+_.value,v.value=[],y.value=P.value-m.value,k.value=F.value-I.value,O.value=!0,g.value?(window.addEventListener("mousemove",B),window.addEventListener("mouseup",H)):(window.addEventListener("touchmove",B),window.addEventListener("touchend",H))},B=()=>{le(),g.value?(C.value=event.clientX,D.value=event.clientY):(C.value=event.changedTouches[0].clientX,D.value=event.changedTouches[0].clientY),C.value<q.value?y.value=0-m.value:C.value>j.value?y.value=b.value-m.value:y.value=C.value-m.value-W.value,D.value<U.value?k.value=0-I.value:D.value>J.value?k.value=N.value-I.value:k.value=D.value-I.value-_.value,v.value.push({x:y.value,y:k.value}),d.value.forEach((l,a)=>{v.value.length>1&&v.value.length>a*A.value&&(l.left=v.value[v.value.length-1-A.value*a].x,l.top=v.value[v.value.length-1-A.value*a].y)}),v.value.length>A.value*(d.value.length-1)+1&&v.value.shift(),(Y.value!==null||Y.value!==void 0)&&clearTimeout(Y.value),Y.value=setTimeout(ce,500)},H=()=>{c.value=p.value.offsetLeft,r.value=p.value.offsetTop,g.value?(window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",H)):(window.removeEventListener("touchmove",B),window.removeEventListener("touchend",H)),P.value===c.value&&F.value===r.value&&G(),setTimeout(()=>{O.value=!1},600)};e.onBeforeUnmount(()=>{window.removeEventListener("resize",V),g.value?(window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",H)):(window.removeEventListener("touchmove",B),window.removeEventListener("touchend",H))});const te=()=>{d.value.length>0&&(p.value=fe(M.value,"menu-item")[0],w.value=p.value.offsetWidth,h.value=p.value.offsetHeight,V(),window.addEventListener("resize",V))},ne=()=>{d.value=L.list.map((l,a)=>(l.left=0,l.top=0,l.style.zIndex=L.list.length+1-a,{...l})),M.value?e.nextTick(()=>{te()}):e.onMounted(()=>{te()})};return/Android|webOS|iPhone|iPod|BlackBerry/i.test(window.navigator.userAgent)&&(g.value=!1),e.watch(()=>L.list,()=>{ne()}),ne(),(l,a)=>{const i=e.resolveComponent("el-icon");return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["vue-drag-menu-plus",e.unref(O)?"move-ing":""]),ref_key:"parentRef",ref:M},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"menu-item",title:t.title,style:e.normalizeStyle({...t.style,left:t.left+"px",top:t.top+"px"}),key:n,onMousedown:s=>n===0&&e.unref(g)?ae():null,onTouchstart:s=>n===0&&!e.unref(g)?ae():null,onClick:s=>n!==0&&!e.unref(O)?G(n):null},[t.customIcon?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.customIcon),{key:0})):t.icon.split("/")[0]==="el"?(e.openBlock(),e.createBlock(i,{key:1},{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.icon.split("/")[1])))]),_:2},1024)):t.icon.split("/")[0]==="iconfont"?(e.openBlock(),e.createElementBlock("i",{key:2,class:e.normalizeClass(["icon iconfont","icon-"+t.icon.split("/")[1]])},null,2)):(e.openBlock(),e.createElementBlock("i",{key:3,class:e.normalizeClass(t.icon.split("/")[0])},e.toDisplayString(t.icon.split("/")[1]),3))],44,ve))),128))],2)}}}],$={install(x){se.forEach(z=>{x.component("vueDragMenuPlus",z)})}};return typeof window<"u"&&window.Vue&&window.Vue.use($),$});
