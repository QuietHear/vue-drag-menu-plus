(function(e,L){typeof exports=="object"&&typeof module<"u"?module.exports=L(require("vue")):typeof define=="function"&&define.amd?define(["vue"],L):(e=typeof globalThis<"u"?globalThis:e||self,e.vueDragMenuPlus=L(e.Vue))})(this,function(e){"use strict";const L={__name:"icon",props:{iconObj:{type:Object,requured:!0}},setup(c){return(X,b)=>{const r=e.resolveComponent("el-icon");return c.iconObj.type==="custom"?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(c.iconObj.icon),e.normalizeProps(e.mergeProps({key:0},c.iconObj.attrs)),null,16)):c.iconObj.type==="el"?(e.openBlock(),e.createBlock(r,e.normalizeProps(e.mergeProps({key:1},c.iconObj.attrs)),{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(c.iconObj.icon)))]),_:1},16)):c.iconObj.type==="iconfont"?(e.openBlock(),e.createElementBlock("i",e.mergeProps({key:2,class:["icon iconfont","icon-"+c.iconObj.icon]},c.iconObj.attrs),null,16)):(e.openBlock(),e.createElementBlock("i",e.mergeProps({key:3,class:c.iconObj.type},c.iconObj.attrs),e.toDisplayString(c.iconObj.icon),17))}}},fe="",ve=["title","onMousedown","onTouchstart","onClick"],ie=[{__name:"index",props:{list:{type:Array,default:()=>[{icon:{type:"icon-insert icon-setting"},title:"菜单",style:{background:"#fff",color:""}},{icon:{type:"icon-insert icon-myCenter"},style:{background:"rgb(255, 92, 92)"}},{icon:{type:"icon-insert icon-notice"},style:{background:"rgb(92, 209, 255)"}},{icon:{type:"icon-insert icon-expression"},style:{background:"rgb(255, 241, 92)"}},{icon:{type:"icon-insert icon-collection"},style:{background:"rgb(100, 245, 146)"}}]},closeOnClick:{type:Boolean,default:!0}},emits:["click"],setup(c,{emit:X}){const b=c;let r=e.ref([]),M=e.ref(null),h=e.ref(null),p=e.ref(null),g=e.ref(null),Y=e.ref(null),A=e.ref(6),v=e.ref(10),T=e.ref(null),m=e.ref(null),I=e.ref(null),B=e.ref(null),N=e.ref(null),P=e.ref(null),E=e.ref(null),k=e.ref(null),S=e.ref(!1),z=e.ref(null),_=e.ref(null),W=e.ref(null),C=e.ref(null),D=e.ref(null),$=e.ref(null),q=e.ref(null),j=e.ref(null),U=e.ref(null),J=e.ref(null),f=e.ref(!1),y=e.ref(!0),i=e.ref([]),d=e.ref(null),w=e.ref(null);const se=(l,a)=>l.classList?l.classList.contains(a):new RegExp("\\s"+a+"\\s").test(" "+l.className+" "),ce=(l,a)=>{let t=[],o=u=>{u.forEach(s=>{se(s,a)&&t.push(s),s.childNodes&&s.childNodes.length>0&&o(s.childNodes)})};return o(l.childNodes),t},n=(l,a,t)=>new Promise((o,u)=>{setTimeout(()=>{for(const s in a)l[s]=a[s];o()},t)}),K=()=>{r.value.forEach(async(l,a)=>{a>0&&(f.value?(await n(l,{top:w.value+v.value},40),await n(l,{top:w.value-v.value},80),await n(l,{top:w.value},50)):(await n(l,{top:w.value-(a*(g.value+v.value)+v.value)},40),await n(l,{top:w.value-a*(g.value+v.value)},100)))}),f.value=!f.value},Q=()=>{r.value.forEach(async(l,a)=>{a>0&&(f.value?(await n(l,{top:w.value-v.value},40),await n(l,{top:w.value+v.value},80),await n(l,{top:w.value},50)):(await n(l,{top:w.value+(a*(g.value+v.value)+v.value)},40),await n(l,{top:w.value+a*(g.value+v.value)},100)))}),f.value=!f.value},Z=()=>{r.value.forEach(async(l,a)=>{a>0&&(f.value?(await n(l,{left:d.value+v.value},40),await n(l,{left:d.value-v.value},80),await n(l,{left:d.value},50)):(await n(l,{left:d.value-(a*(p.value+v.value)+v.value)},40),await n(l,{left:d.value-a*(p.value+v.value)},100)))}),f.value=!f.value},ee=()=>{r.value.forEach(async(l,a)=>{a>0&&(f.value?(await n(l,{left:d.value-v.value},40),await n(l,{left:d.value+v.value},80),await n(l,{left:d.value},50)):(await n(l,{left:d.value+(a*(p.value+v.value)+v.value)},40),await n(l,{left:d.value+a*(p.value+v.value)},100)))}),f.value=!f.value},F=(l=0)=>{if(X("click",b.list[l],l),l===0||b.closeOnClick){let a,t,o,u;a=h.value.offsetLeft,t=h.value.offsetTop,a>0?t<0?(o=T.value/2-a-p.value,u=m.value/2+t,o+10<u?Z():Q()):(o=T.value/2-a-p.value,u=m.value/2-t-g.value,o+10<u?Z():K()):t<0?(o=T.value/2+a,u=m.value/2+t,o+10<u?ee():Q()):(o=T.value/2+a,u=m.value/2-t-g.value,o+10<u?ee():K())}},le=()=>{f.value&&F(0)},G=()=>{le(),T.value=window.innerWidth,m.value=window.innerHeight,N.value=T.value-p.value,P.value=m.value-g.value,I.value=M.value.offsetLeft,B.value=M.value.offsetTop,E.value=N.value-I.value-10,k.value=P.value-B.value-10,r.value.forEach(l=>{l.left=E.value,l.top=k.value})},re=()=>{if(i.value.length>1){let l,a,t=i.value[i.value.length-2].x,o=i.value[i.value.length-2].y,u=i.value[i.value.length-1].x,s=i.value[i.value.length-1].y,R=Math.abs(u-t),oe=Math.abs(s-o);R===0?(l=0,a=v.value):(l=Math.sqrt(Math.pow(v.value,2)*Math.pow(R,2)/(Math.pow(R,2)+Math.pow(oe,2))),a=l*oe/R),r.value.forEach((x,ue)=>{ue>0&&setTimeout(async()=>{await n(x,{left:t,top:o},50),await n(x,{left:u>t?u+l:u-l,top:s>o?s+a:s-a},50),await n(x,{left:u>t?u-l:u+l,top:s>o?s-a:s+a},100),await n(x,{left:u,top:s},50)},ue*120)})}i=[]},ae=()=>{y.value?(W.value=event.offsetX,C.value=event.offsetY):(W.value=event.changedTouches[0].clientX-T.value/2-h.value.offsetLeft,C.value=event.changedTouches[0].clientY-m.value/2-h.value.offsetTop),z.value=h.value.offsetLeft,_.value=h.value.offsetTop,$.value=W.value,q.value=N.value+W.value,U.value=C.value,J.value=P.value+C.value,i.value=[],E.value=z.value-I.value,k.value=_.value-B.value,S.value=!0,y.value?(window.addEventListener("mousemove",O),window.addEventListener("mouseup",H)):(window.addEventListener("touchmove",O),window.addEventListener("touchend",H))},O=()=>{le(),y.value?(D.value=event.clientX,j.value=event.clientY):(D.value=event.changedTouches[0].clientX,j.value=event.changedTouches[0].clientY),D.value<$.value?E.value=0-I.value:D.value>q.value?E.value=N.value-I.value:E.value=D.value-I.value-W.value,j.value<U.value?k.value=0-B.value:j.value>J.value?k.value=P.value-B.value:k.value=j.value-B.value-C.value,i.value.push({x:E.value,y:k.value}),r.value.forEach((l,a)=>{i.value.length>1&&i.value.length>a*A.value&&(l.left=i.value[i.value.length-1-A.value*a].x,l.top=i.value[i.value.length-1-A.value*a].y)}),i.value.length>A.value*(r.value.length-1)+1&&i.value.shift(),(Y.value!==null||Y.value!==void 0)&&clearTimeout(Y.value),Y.value=setTimeout(re,500)},H=()=>{d.value=h.value.offsetLeft,w.value=h.value.offsetTop,y.value?(window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",H)):(window.removeEventListener("touchmove",O),window.removeEventListener("touchend",H)),z.value===d.value&&_.value===w.value&&F(),setTimeout(()=>{S.value=!1},600)};e.onBeforeUnmount(()=>{window.removeEventListener("resize",G),y.value?(window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",H)):(window.removeEventListener("touchmove",O),window.removeEventListener("touchend",H))});const te=()=>{r.value.length>0&&(h.value=ce(M.value,"menu-item")[0],p.value=h.value.offsetWidth,g.value=h.value.offsetHeight,G(),window.addEventListener("resize",G))},ne=()=>{r.value=b.list.map((l,a)=>(l.left=0,l.top=0,l.style.zIndex=b.list.length+1-a,{...l})),M.value?e.nextTick(()=>{te()}):e.onMounted(()=>{te()})};return/Android|webOS|iPhone|iPod|BlackBerry/i.test(window.navigator.userAgent)&&(y.value=!1),e.watch(()=>b.list,()=>{ne()}),ne(),(l,a)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["vue-drag-menu-plus",e.unref(S)?"move-ing":""]),ref_key:"parentRef",ref:M},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:"menu-item",title:t.title,style:e.normalizeStyle({...t.style,left:t.left+"px",top:t.top+"px"}),key:o,onMousedown:u=>o===0&&e.unref(y)?ae():null,onTouchstart:u=>o===0&&!e.unref(y)?ae():null,onClick:u=>o!==0&&!e.unref(S)?F(o):null},[t.icon&&(t.icon.icon||t.icon.type)?(e.openBlock(),e.createBlock(L,{key:0,iconObj:t.icon},null,8,["iconObj"])):e.createCommentVNode("",!0)],44,ve))),128))],2))}}],V={install(c){ie.forEach(X=>{c.component("vueDragMenuPlus",X)})}};return typeof window<"u"&&window.Vue&&window.Vue.use(V),V});
