(function(e,W){typeof exports=="object"&&typeof module<"u"?module.exports=W(require("vue")):typeof define=="function"&&define.amd?define(["vue"],W):(e=typeof globalThis<"u"?globalThis:e||self,e.vueDragMenuPlus=W(e.Vue))})(this,function(e){"use strict";const W="",oe=["title","onMousedown","onTouchstart","onClick"],ue=[{__name:"index",props:{list:{type:Array,default:()=>[{icon:"icon-insert icon-setting",title:"\u83DC\u5355",style:{background:"#fff",color:""}},{icon:"icon-insert icon-myCenter",style:{background:"rgb(255, 92, 92)"}},{icon:"icon-insert icon-notice",style:{background:"rgb(92, 209, 255)"}},{icon:"icon-insert icon-expression",style:{background:"rgb(255, 241, 92)"}},{icon:"icon-insert icon-collection",style:{background:"rgb(100, 245, 146)"}}]},closeOnClick:{type:Boolean,default:!0}},emits:["click"],setup(x,{emit:z}){const D=x;let d=e.ref([]),X=e.ref(null),p=e.ref(null),w=e.ref(null),h=e.ref(null),N=e.ref(null),Y=e.ref(6),u=e.ref(10),T=e.ref(null),E=e.ref(null),k=e.ref(null),I=e.ref(null),A=e.ref(null),b=e.ref(null),y=e.ref(null),m=e.ref(null),O=e.ref(!1),P=e.ref(null),F=e.ref(null),B=e.ref(null),M=e.ref(null),_=e.ref(null),q=e.ref(null),J=e.ref(null),C=e.ref(null),j=e.ref(null),U=e.ref(null),f=e.ref(!1),g=e.ref(!0),v=e.ref([]),r=e.ref(null),c=e.ref(null);const ve=(l,a)=>l.classList?l.classList.contains(a):new RegExp("\\s"+a+"\\s").test(" "+l.className+" "),se=(l,a)=>{let i=[],t=n=>{n.forEach(s=>{ve(s,a)&&i.push(s),s.childNodes&&s.childNodes.length>0&&t(s.childNodes)})};return t(l.childNodes),i},o=(l,a,i)=>new Promise((t,n)=>{setTimeout(()=>{for(const s in a)l[s]=a[s];t()},i)}),K=()=>{d.value.forEach(async(l,a)=>{a>0&&(f.value?(await o(l,{top:c.value+u.value},40),await o(l,{top:c.value-u.value},80),await o(l,{top:c.value},50)):(await o(l,{top:c.value-(a*(h.value+u.value)+u.value)},40),await o(l,{top:c.value-a*(h.value+u.value)},100)))}),f.value=!f.value},Q=()=>{d.value.forEach(async(l,a)=>{a>0&&(f.value?(await o(l,{top:c.value-u.value},40),await o(l,{top:c.value+u.value},80),await o(l,{top:c.value},50)):(await o(l,{top:c.value+(a*(h.value+u.value)+u.value)},40),await o(l,{top:c.value+a*(h.value+u.value)},100)))}),f.value=!f.value},Z=()=>{d.value.forEach(async(l,a)=>{a>0&&(f.value?(await o(l,{left:r.value+u.value},40),await o(l,{left:r.value-u.value},80),await o(l,{left:r.value},50)):(await o(l,{left:r.value-(a*(w.value+u.value)+u.value)},40),await o(l,{left:r.value-a*(w.value+u.value)},100)))}),f.value=!f.value},ee=()=>{d.value.forEach(async(l,a)=>{a>0&&(f.value?(await o(l,{left:r.value-u.value},40),await o(l,{left:r.value+u.value},80),await o(l,{left:r.value},50)):(await o(l,{left:r.value+(a*(w.value+u.value)+u.value)},40),await o(l,{left:r.value+a*(w.value+u.value)},100)))}),f.value=!f.value},G=(l=0)=>{if(z("click",D.list[l]),l===0||D.closeOnClick){let a,i,t,n;a=p.value.offsetLeft,i=p.value.offsetTop,a>0?i<0?(t=T.value/2-a-w.value,n=E.value/2+i,t+10<n?Z():Q()):(t=T.value/2-a-w.value,n=E.value/2-i-h.value,t+10<n?Z():K()):i<0?(t=T.value/2+a,n=E.value/2+i,t+10<n?ee():Q()):(t=T.value/2+a,n=E.value/2-i-h.value,t+10<n?ee():K())}},le=()=>{f.value&&G(0)},V=()=>{le(),T.value=window.innerWidth,E.value=window.innerHeight,A.value=T.value-w.value,b.value=E.value-h.value,k.value=X.value.offsetLeft,I.value=X.value.offsetTop,y.value=A.value-k.value-10,m.value=b.value-I.value-10,d.value.forEach(l=>{l.left=y.value,l.top=m.value})},ie=()=>{if(v.value.length>1){let l,a,i=v.value[v.value.length-2].x,t=v.value[v.value.length-2].y,n=v.value[v.value.length-1].x,s=v.value[v.value.length-1].y,S=Math.abs(n-i),te=Math.abs(s-t);S===0?(l=0,a=u.value):(l=Math.sqrt(Math.pow(u.value,2)*Math.pow(S,2)/(Math.pow(S,2)+Math.pow(te,2))),a=l*te/S),d.value.forEach((R,ne)=>{ne>0&&setTimeout(async()=>{await o(R,{left:i,top:t},50),await o(R,{left:n>i?n+l:n-l,top:s>t?s+a:s-a},50),await o(R,{left:n>i?n-l:n+l,top:s>t?s-a:s+a},100),await o(R,{left:n,top:s},50)},ne*120)})}v=[]},ae=()=>{g.value?(B.value=event.offsetX,M.value=event.offsetY):(B.value=event.changedTouches[0].clientX-T.value/2-p.value.offsetLeft,M.value=event.changedTouches[0].clientY-E.value/2-p.value.offsetTop),P.value=p.value.offsetLeft,F.value=p.value.offsetTop,q.value=B.value,J.value=A.value+B.value,j.value=M.value,U.value=b.value+M.value,v.value=[],y.value=P.value-k.value,m.value=F.value-I.value,O.value=!0,g.value?(window.addEventListener("mousemove",L),window.addEventListener("mouseup",H)):(window.addEventListener("touchmove",L),window.addEventListener("touchend",H))},L=()=>{le(),g.value?(_.value=event.clientX,C.value=event.clientY):(_.value=event.changedTouches[0].clientX,C.value=event.changedTouches[0].clientY),_.value<q.value?y.value=0-k.value:_.value>J.value?y.value=A.value-k.value:y.value=_.value-k.value-B.value,C.value<j.value?m.value=0-I.value:C.value>U.value?m.value=b.value-I.value:m.value=C.value-I.value-M.value,v.value.push({x:y.value,y:m.value}),d.value.forEach((l,a)=>{v.value.length>1&&v.value.length>a*Y.value&&(l.left=v.value[v.value.length-1-Y.value*a].x,l.top=v.value[v.value.length-1-Y.value*a].y)}),v.value.length>Y.value*(d.value.length-1)+1&&v.value.shift(),(N.value!==null||N.value!==void 0)&&clearTimeout(N.value),N.value=setTimeout(ie,500)},H=()=>{r.value=p.value.offsetLeft,c.value=p.value.offsetTop,g.value?(window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",H)):(window.removeEventListener("touchmove",L),window.removeEventListener("touchend",H)),P.value===r.value&&F.value===c.value&&G(),setTimeout(()=>{O.value=!1},600)};e.onMounted(()=>{d.value.length>0&&(p.value=se(X.value,"menu-item")[0],w.value=p.value.offsetWidth,h.value=p.value.offsetHeight,V(),window.addEventListener("resize",V))}),e.onBeforeUnmount(()=>{window.removeEventListener("resize",V),g.value?(window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",H)):(window.removeEventListener("touchmove",L),window.removeEventListener("touchend",H))});let fe=JSON.parse(JSON.stringify(D.list));return d.value=fe.map((l,a)=>(l.left=0,l.top=0,l.style.zIndex=D.list.length+1-a,{...l})),/Android|webOS|iPhone|iPod|BlackBerry/i.test(window.navigator.userAgent)&&(g.value=!1),(l,a)=>{const i=e.resolveComponent("el-icon");return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["vue-drag-menu-plus",e.unref(O)?"move-ing":""]),ref_key:"parentRef",ref:X},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"menu-item",title:t.title,style:e.normalizeStyle({...t.style,left:t.left+"px",top:t.top+"px"}),key:n,onMousedown:s=>n===0&&e.unref(g)?ae():null,onTouchstart:s=>n===0&&!e.unref(g)?ae():null,onClick:s=>n!==0&&!e.unref(O)?G(n):null},[t.icon.split("/")[0]==="el"?(e.openBlock(),e.createBlock(i,{key:0},{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.icon.split("/")[1])))]),_:2},1024)):t.icon.split("/")[0]==="iconfont"?(e.openBlock(),e.createElementBlock("i",{key:1,class:e.normalizeClass(["icon iconfont","icon-"+t.icon.split("/")[1]])},null,2)):(e.openBlock(),e.createElementBlock("i",{key:2,class:e.normalizeClass(t.icon.split("/")[0])},e.toDisplayString(t.icon.split("/")[1]),3))],44,oe))),128))],2)}}}],$={install(x){ue.forEach(z=>{x.component("vueDragMenuPlus",z)})}};return typeof window<"u"&&window.Vue&&window.Vue.use($),$});
